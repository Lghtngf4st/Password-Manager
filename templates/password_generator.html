{% extends "layout.html" %}

{% block title %}
    Password Generator
{% endblock %}

{% block main %}
    <div class="row justify-content-center">
        <div class="col-12 col-md-7 col-lg-6 text-start">
            <h1 class="h3 mb-2">Password Generator</h1>
            <p class="text-muted mb-4">
                Generate a strong, random password. nothing is saved unless you copy it yourself.
            </p>

            <div class="mb-3">
                <label for="generatedPassword" class="form-label">Generated Password</label>
                <div class="input-group">
                    <input class="form-control" id="generatedPassword" type="text" readonly placeholder="Click Generate">
                    <button class="btn btn-outline-dark" type="button" id="copyBtn">Copy</button>
                </div>
            </div>

            <div class="border rounded p-3 mb-3">
                <div class="row g-3 align-items-center">
                    <div class="col-12 col-sm-4">
                        <label for="length" class="form-label">Length</label>
                        <input class="form-control" id="length" type="number" min="8" max="64" value="16">
                    </div>

                    <div class="col-12 col-sm-8">
                        <label class="form-label d-block">Character types</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="lower" checked>
                            <label class="form-check-label" for="lower">Lowercase (a-z)</label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="upper" checked>
                            <label class="form-check-label" for="upper">Uppercase (A-Z)</label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="digits" checked>
                            <label class="form-check-label" for="digits">Digits (0-9)</label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="symbols" checked>
                            <label class="form-check-label" for="symbols">Symbols (!@#...)</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-grid gap-2 d-sm-flex justify-content-sm-end">
                <button class="btn btn-outline-secondary" type="button" id="clearBtn">Clear</button>
                <button class="btn btn-primary" type="button" id="generateBtn">Generate</button>
            </div>
        </div>
    </div>

    <script>
        (function () {
            const output = document.getElementById("generatedPassword");
            const generateBtn = document.getElementById("generateBtn");
            const copyBtn = document.getElementById("copyBtn");
            const clearBtn = document.getElementById("clearBtn");

            generateBtn.addEventListener("click", async () => {
                const form = new FormData();
                form.append("length", document.getElementById("length").value);
                form.append("lower", document.getElementById("lower").checked ? "1" : "0");
                form.append("upper", document.getElementById("upper").checked ? "1" : "0");
                form.append("digits", document.getElementById("digits").checked ? "1" : "0");
                form.append("symbols", document.getElementById("symbols").checked ? "1" : "0");
            
                const res = await fetch("/password_generator", {
                    method: "POST",
                    body: form
                });

                const data = await res.json();
                if (data.error) {
                    alert(data.error);
                    return;
                }

                output.value = data.password || "";
            });

            copyBtn.addEventListener("click", async () => {
                if (!output.value) return;
                await navigator.clipboard.writeText(output.value);
                copyBtn.textContent = "Copied";
                setTimeout(() => (copyBtn.textContent = "Copy"), 900);
            });

            clearBtn.addEventListener("click", () => {
                output.value = "";
            });
        })();
    </script>
{% endblock %}